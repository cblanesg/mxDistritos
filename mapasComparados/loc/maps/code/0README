code adapted from /elecs/MX.../atlasDis/code/
